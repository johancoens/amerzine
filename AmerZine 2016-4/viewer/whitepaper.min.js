function IMUser(a){var b=$.extend(a,{save:function(a,c){b.raw&&Magazine.whitepaper.api.saveProfile(b.raw,function(c){b.setProfile(c._glimpsed),delete b.raw,a(b)},c)},setProfile:function(a){for(var c in a)0===c.indexOf("__")?b[c.replace(/__/g,"")]=a[c]:b[c]=a[c]},getProfile:function(){var a={};for(var c in b)"function"!=typeof b[c]&&(a[c]=b[c]);return a}});return b}var Whitepaper=function(a){var b=function(){var b,c={load:function(b){Loader.loadFiles([Config.viewer_url+"/script/whitepaper/view.html"],function(e){1===a.type.length&&a.type[0]===WHITEPAPER.TYPE.EMAIL?a.platforms=[]:a.platforms=d,c.container=$(Hogan.compile(e[0].response).render(a)),b(c)})},show:function(e){var f=c.container.find(".screen");if(".form"!==e&&1===a.type.length&&a.type[0]===WHITEPAPER.TYPE.EMAIL)return e=".form",b="platform",f.css("opacity",0),void d[WHITEPAPER.TYPE.EMAIL].login(!1);if(f.css("opacity",1),void 0===b&&c.container.find(".container").startAnimation(Animation.fadeInUp),e===WHITEPAPER.SCREEN.FORM){if("platform"===b)if(c.container.find(WHITEPAPER.SCREEN.PLATFORM).startAnimation(Animation.fadeOutUp,{},function(){c.container.find(WHITEPAPER.SCREEN.FORM).startAnimation(Animation.fadeInUp),d[WHITEPAPER.TYPE.EMAIL].show()}),c.container.outerHeight()<c.container.find(WHITEPAPER.SCREEN.FORM)[0].scrollHeight)f.css({top:"",position:"relative",marginTop:""});else{var g=-((f.height()+c.container.find(WHITEPAPER.SCREEN.FORM)[0].scrollHeight-c.container.find(WHITEPAPER.SCREEN.PLATFORM)[0].scrollHeight)/2);f.css({marginTop:g})}else if(c.container.find(WHITEPAPER.SCREEN.FORM).startAnimation(Animation.fadeInUp),d[WHITEPAPER.TYPE.EMAIL].show(),$(document).outerHeight()<c.container.find(WHITEPAPER.SCREEN.FORM)[0].scrollHeight)f.css({top:"",position:"relative",marginTop:""});else{var g=-((f.height()+c.container.find(WHITEPAPER.SCREEN.FORM)[0].scrollHeight)/2)+"px";f.css({top:"50%",marginTop:g,position:"absolute"})}b=e}else b===WHITEPAPER.SCREEN.FORM?c.container.find(WHITEPAPER.SCREEN.FORM).startAnimation(Animation.fadeOutUp,{},function(){c.container.find(WHITEPAPER.SCREEN.PLATFORM).startAnimation(Animation.fadeInUp),c.container.parent().handleAlignments()}):c.container.find(WHITEPAPER.SCREEN.PLATFORM).startAnimation(Animation.fadeInUp),b="platform"},hide:function(a){b===WHITEPAPER.SCREEN.FORM?c.container.find(WHITEPAPER.SCREEN.FORM).startAnimation(Animation.fadeOutUp,{},function(){a()}):c.container.find(WHITEPAPER.SCREEN.PLATFORM).startAnimation(Animation.fadeOutUp,{},function(){a()})},getScreen:function(a){return c.container.find(a)},appendTo:function(a){a.append(c.container),c.container.find(".screen").addClass("im-align center-center im-stay-visible"),c.container.parent().handleAlignments()},setFormContainer:function(a){c.container.find(".form").append(a),c.container.parent().handleAlignments()},destroy:function(){try{c.container.remove()}catch(a){}}};return c},c={getFormData:function(b){void 0===c.data?Magazine.getApi().getForm(a.id,function(a){c.data=a,b(c.data)}):b(c.data)},saveProfile:function(a,b,c){var d=Magazine.storage.get("im-login");d||a&&Magazine.getApi().postContact(Magazine.id,a,function(a){b(a)})}},d={},e={facebook:IMFacebook,linkedin:IMLinkedIn,email:IMEmail},f={loginComplete:function(a){h.user=this.profile,Magazine.storage.set("im-login",this.profile.getProfile()),h.events.trigger(WHITEPAPER.EVENTS.LOGIN,this.profile)},notAuthorized:function(){for(var c in d)if(!d[c].ready)return;void 0===h.view&&new b(a).load(function(a){h.setView(a),h.events.trigger(WHITEPAPER.EVENTS.READY)})}},g=function(){var a=Magazine.storage.get("im-login");a?(h.user=new IMUser(a),h.events.trigger(WHITEPAPER.EVENTS.LOGIN,h.user)):h.setPlatforms()},h={api:c,authenticate:function(){},init:g,login:function(a){Magazine.tracker.trackEvent("whitepaper","click",a.toLowerCase()),d[a].login()},skip:function(){h.events.trigger(WHITEPAPER.EVENTS.LOGIN,new IMUser,!0)},setView:function(a){this.view=a},setPlatforms:function(){(!a.type||a.type&&0===a.type.length)&&(a.type=a.type||[],a.type.push(WHITEPAPER.TYPE.EMAIL));for(var b=0;b<a.type.length;b++){var c,g=a.type[b];e[g]&&(c=g===WHITEPAPER.TYPE.EMAIL?a:a[g],d[g]=e[g](c,f))}},destroy:function(){this.view.destroy()},events:new IMEvents(this)};return h},WHITEPAPER={TYPE:{FACEBOOK:"facebook",LINKEDIN:"linkedin",EMAIL:"email"},EVENTS:{LOGIN:"loginComplete",READY:"ready"},SCREEN:{FORM:".form",PLATFORM:".choose-platform"}},IMFacebook=function(a,b){"use strict";var c,d=function(){window.fbAsyncInit=function(){FB.init({appId:a.api_key,xfbml:!0,version:"v2.5"}),FB.getLoginStatus(function(a){f(a)}),c=setTimeout(function(){Config.is_preview?confirm("To test Facebook you need to allow the following domain "+window.location.origin+". Do you want to skip Facebook for now?")?f({status:"not_authorized"}):(g.profile=null,b.loginComplete.apply(g,g.profile)):(clearInterval(c),c=setTimeout(function(){alert("Facebook App is not setup correctly. Make sure Facebook has access to "+window.location.origin+".")},5e3))},5e3)};var d=document.createElement("div");d.id="fb-root",document.getElementsByTagName("body")[0].appendChild(d),include("//connect.facebook.net/en_US/sdk.js",null,"facebook-jssdk")},e=function(){g.getProfile(function(a){a.error?b.notAuthorized.apply(g):(g.profile=a,b.loginComplete.apply(g))})},f=function(a){g.ready=!0,clearInterval(c),"connected"===a.status?e():"not_authorized"===a.status?b.notAuthorized.apply(g):b.notAuthorized.apply(g)},g={ready:!1,type:WHITEPAPER.TYPE.FACEBOOK,authenticate:function(){},login:function(){FB.login(function(){e()},{scope:["email","user_location","public_profile","user_birthday","user_hometown"]})},getProfile:function(a){FB.api("/me?fields=id,name,email,hometown,gender,birthday,locale",function(b){if(b.error)return void a(b);b.source="facebook";var c=new IMUser({raw:b});c.save(a)})}};return d(),g},IMLinkedIn=function(a,b){var c=function(){window.onLinkedInLoad=function(){IN.Event.on(IN,"auth",d),IN.User.isAuthorized()?f.ready=!0:(f.ready=!0,b.notAuthorized.apply(f))},Loader.loadExternalJs("//platform.linkedin.com/in.js?async=true",function(){IN.init({onLoad:"onLinkedInLoad",api_key:a.api_key,authorize:!0})})},d=function(a){f.getProfile(function(a){f.profile=a,b.loginComplete.apply(f)})},e=["id","first_name","last_name","maiden-name","formatted-name","num-connections","picture-url","phonetic-first-name","headline","location","industry","current-share","num-connections-capped","summary","specialties","positions","picture-urls","site-standard-profile-request","email-address"],f={ready:!1,type:WHITEPAPER.TYPE.LINKEDIN,login:function(){IN.User.authorize(function(a){},f)},getProfile:function(a,c){IN.API.Raw("/people/~:("+e.join(",")+")").result(function(b){b.source="linkedin";var c=new IMUser({raw:b});f.profile=c,c.save(a)}).error(function(a){"function"==typeof c&&c(a),b.notAuthorized.apply(f)})}};return c(),f},IMEmail=function(a,b){"use strict";var c,d,e=$('<div class="im-ts-paragraph im-whitepaper-form"><form></form></div>'),f=function(a){if(a.result.success===!0){var e=c.dynamicForm.getNormalValues();e.source="standard",d=new IMUser,d.setProfile(e),d.raw=d.getProfile(),delete d.raw.id,h.profile=d,d.save(function(){b.loginComplete.apply(h,h.profile,!0)})}},g=function(){b.notAuthorized()},h={ready:!0,type:WHITEPAPER.TYPE.FACEBOOK,login:function(b){var d=Magazine.whitepaper.view.getScreen(WHITEPAPER.SCREEN.FORM);if(d.show().css({opacity:0,height:0}),0===e.parent().length){Magazine.whitepaper.view.setFormContainer(e),Magazine.whitepaper.api.getFormData(function(b){c=new DynamicForm(a.id,e,null,b),c.onSubmit=f,Magazine.whitepaper.view.show(WHITEPAPER.SCREEN.FORM)});var g=$('<a class="back-button"><span>&#59237;</span> '+Utils.viewHelper("translate",["btn_back"])+"</a>");g.on("click",function(){Magazine.whitepaper.view.show(),Magazine.tracker.trackEvent("whitepaper","click","back")});var h=0;for(var i in Magazine.whitepaper.availablePlatforms)h++;h>1&&e.append(g)}else Magazine.whitepaper.view.show(WHITEPAPER.SCREEN.FORM)},show:function(){var a=Magazine.whitepaper.view.getScreen(WHITEPAPER.SCREEN.FORM);a.css({height:a[0].scrollHeight,opacity:""})},getProfile:function(a){a(d?d:{error:"unknown profile found"})}};return g(),h};Loader.loadComplete();