function ProductController(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=!1,o=null,p=250,q=function(){function c(){var b=!1;"top"==n.content.nav_type&&(n.content.nav_type="circle",b=!0),e.init(a.container,NavigationButtonType[n.content.nav_type.toUpperCase()]),e.setTop(b)}null!==n.content.background&&(a.getBackground().init([n.content.background]),a.container.prepend(a.getBackground().render()),a.getBackground().show()),j=a.container.find(".im-pr"),j.on("mousewheel scroll",y),n.content.nav_type&&(e=new NavigationButtons,c(),e.onUp=function(){z(-Magazine.pages.height-50),Magazine.tracker.trackEvent("Scroll","Click","Up")},e.onDown=function(){z(Magazine.pages.height-50),Magazine.tracker.trackEvent("Scroll","Click","Down")});var d=a.container.find(".header");d.length>0&&(h=!0,a.container.find(".im-pr").addClass("withheader"));var f=0;k=[];for(var g=0;g<n.content.item.length;g++){var i=n.content.item[g];if(null!==i.product&&0!==i.product.length){for(var l=(new DynamicGrid).init($($(a.container).find(".im-pr-list")[f]),{maxCols:3,maxBlockWidth:p+100,minBlockWidth:p,loadCount:20,padding:n.content.padding||2,align:n.content.text_align||"center",fixedBlockHeight:!0}),m=0;m<i.product.length;m++){""===i.product[m].button&&delete i.product[m].button;var o=$(b.render($.extend(i.product[m],{product:m,category:g})));o.scanDirectives(a),l.add(o,{width:200,height:200})}k.push(l),f++}}},r=function(){m=new ImList,m.init($(".scroller",a.container),$(".scroller",a.container).children(".im-pr-m-list"),{onScroll:function(b){a.onScrollHandler($(".scroller",a.container).scrollTop())}}),j=a.container.find(".scroller"),m.preload=20,m.setSegments(n.content.item),m.getSegmentFooter=function(a,b){return!!b.intro&&$('<div class="text" style='+b.mobile_intro_bg_style.replace(/\s/g,"")+'><div class="paragraph" style='+b.mobile_intro_style.replace(/\s/g,"")+">"+b.intro+"</div></div>")},m.getSegment=function(a,b){var c="";return b.title&&(c+='<h1 class="im-ts-title" style='+b.mobile_title_style.replace(/\s/g,"")+">"+b.title+"</h1>"),c+=b.description?b.description:"",c.length>0?$('<div class="text" style='+b.mobile_paragraph_bg_style.replace(/\s/g,"")+'><div class="paragraph" style='+b.mobile_paragraph_style.replace(/\s/g,"")+">"+c+"</div></div>"):$()},m.getItemByIndex=function(a,b){var d=n.content.item[b].product[a];null!==d.image&&"undefined"==typeof d.image_css&&(d.image_css={"background-image":"url('"+Utils.viewHelper("getImageUrl",[d.image.uri,null,null,600,600])+"')"},"object"==typeof d.image.settings&&"undefined"!=typeof d.image.settings.position&&(d.image_css["background-position"]=d.image.settings.position));var e=$(c.render(d));return"undefined"!=typeof d.image_css&&e.children(".webshop-image").css(d.image_css),e},m.load()},s=function(a,b){Magazine.device.size<DeviceSize.PORTRAIT?u(n.content.item[a].product[b]):v(n.content.item[a].product[b])},t=function(a){return!(!a||!a.width)&&Magazine.pages.width/a.width*a.height},u=function(b){var c,d=new SubPage;b.image&&(c=t(b.image)),d.data={title:b.title,subtitle:b.subtitle,description:b.description+'<br><p class="price" style='+b.mobile_price_style.replace(/\s/g,"")+">"+b.price+"</p>",image:b.image,imageHeight:c,button:[{action:b.detailAction,label:b.button}],style:{titleStyle:b.mobile_title_style,descriptionStyle:b.mobile_paragraph_style,backgroundStyle:b.mobile_background_style}},a.pushPage(d)},v=function(b){if(Magazine.device.size>DeviceSize.MOBILE_LANDSCAPE){if(null!==o){if(b.index===o.index)return;o.hide(),o=null}"undefined"==typeof b.details?(o=new x,o.init(b)):o=b.details,o.show(),a.container.addClass("open-details"),l.show()}else"undefined"==typeof b.details?(o=new x,o.init(b)):o=b.details,o.show()},w=function(){a.container.removeClass("open-details"),l.hide(),null!==o&&(o.hide(),o=null)},x=function(){var b;this.view=null,this.index,this.init=function(c){b=$.extend({},c),this.index=b.index,b.details=this,b.urlbase="#!/"+a.alias,b.order_label=n.content.order_label},this.show=function(){var c=this;if(Magazine.device.size>DeviceSize.MOBILE_LANDSCAPE)null===this.view&&this.render(),this.view.scanDirectives(a),this.view.find(".im-media")[0].imMedia.imageTag=!1,this.view.find(".im-media")[0].imMedia.setMedia(b.image),a.container.find(".im-pr-details").append(this.view),this.view.find(".dynamicForm").each(function(){new DynamicForm(null,$(this))}),this.view[0].offsetHeight,Magazine.device.requestAnimationFrame(function(){c.view.addClass("show"),c.onResize()});else{var d=new SubPage;d.htmltemplate=_productMobileDetailsView,d.data=$.extend({mobile:!0},b),a.pushPage(d,void 0,function(){this.container.find(".im-media")[0].imMedia.imageTag=!1,this.container.find(".im-media")[0].imMedia.setMedia(b.image)},function(){this.container.find(".im-media")[0].imMedia.release()})}},this.hide=function(){var a=this,c=Magazine.device.getCssProperty("transitionend"),d=function(){a.view.off(c),a.view.find(".im-media")[0].imMedia.release(),a.view.remove(),a.view=null,b=void 0};Magazine.device.isIE8?d():(this.view.on(c,function(){d()}),this.view.removeClass("show"))},this.release=function(){null!==this.view&&this.view.length>0&&(this.view.off(Magazine.device.getCssProperty("transitionend")),this.view.find(".im-media")[0].imMedia.release(),this.view.remove(),this.view=null,b=void 0)},this.render=function(){this.view=$(d.render(b))},this.onResize=function(){if(Magazine.device.size>DeviceSize.MOBILE_LANDSCAPE){var a=$(".detail-text",this.view),b=$(".im-webshop-p",this.view),c=$(".detail-price",this.view),d=b.outerHeight()-b.height();Magazine.device.width<1250&&Magazine.device.height>1e3?b.css("height","310px"):b.css("height",this.view.height()-c.outerHeight()-d-25-a.outerHeight()+"px")}}},y=function(){f.each(function(a){"undefined"!=typeof $(this)[0].imParallax&&$(this)[0].imParallax.onScroll()});var b=j.scrollTop(),c=A(),d=100/(c/b);0!==c&&(e&&e.onScroll(b,b+Magazine.pages.height,j[0].scrollHeight),Math.floor(d/25)!=i&&(i=Math.floor(d/25),Magazine.tracker.trackEvent("Scroll",b>g?"Down":"Up",25*i+"%")),a.onScrollHandler(b),g=b)},z=function(b){var c,d=$(".im-pr",a.container),e={y:d.scrollTop()};c=isNaN(b)?d.scrollTop()+b.offset().top-Magazine.pages.offset.top:d.scrollTop()+b,c=Math.max(0,Math.min(c,d[0].scrollHeight-d.outerHeight())),TweenLite.to(e,1,{y:c,ease:"easeInOutCubic",onUpdate:function(){d.scrollTop(e.y),y(d)}})},A=function(){return"undefined"!=typeof j?Math.max(0,j[0].scrollHeight-Magazine.pages.height):0},B=function(b){return b.action=new ActionModel(b.description?"#!/"+a.alias+"/cat/"+b.category+"/item/"+b.index:b.buttonlink),b.button&&b.buttonlink&&(b.detailAction=new ActionModel(b.buttonlink)),b};this.init=function(b){a=b},this.onLoad=function(e){Loader.loadFiles([Config.templatePathView+a.template+"/product.html",Config.templatePathView+a.template+"/details.html",Config.templatePathView+a.template+"/productMobile.html"],function(a){b=Hogan.compile(a[0].response),d=Hogan.compile(a[1].response),c=Hogan.compile(a[2].response),e()}),l=new TransparentOverlay,l.opacity=.6,l.init(a.container),l.setOnClick(function(){window.location.href="#!/"+a.alias})},this.didLoadView=function(){Magazine.device.size<DeviceSize.PORTRAIT?r():q(),f=a.scanDirectives()},this.willLoad=function(){},this.didLoad=function(a){n=a},this.didAppear=function(){a.container.handleAlignments()},this.willAppear=function(a){if(k)for(var b=0;b<k.length;b++)k[b].setPosition();a.item?s(a.cat||0,a.item||0):w()},this.onHashChange=function(a){a.item?s(a.cat||0,a.item||0):w()},this.onResizeHandler=function(b){h&&a.container.find(".im-pr").height(Magazine.pages.height-a.container.find(".header").outerHeight())},this.onEndResizeHandler=function(b){if(k)for(var c=0;c<k.length;c++)k[c].setPosition();h&&a.container.find(".im-pr").height(Magazine.pages.height-a.container.find(".header").outerHeight()),Magazine.device.size>=DeviceSize.PORTRAIT&&e&&("relative"===a.container.find(".im-pr-overview").css("position")?e.show():e.hide())},this.onOrientationChange=function(){},this.willDisappear=function(){},this.render=function(a){a.item=a.item||[],a.itemCount=0,a.actionmodel=new ActionModel(a.buttonlink),a.list=[];for(var b=0;b<a.item.length;b++){a.item[b].product=a.item[b].product||[],a.item[b].hasIntro=!!a.item[b].title||a.item[b].description,a.item[b].count=a.item[b].product.length;var c=new StyleModel(a.item[b].style);a.item[b].title_style=c.get(["title","title_background"]),a.item[b].paragraph_style=c.get(["paragraph","paragraph_background"]),a.item[b].intro_style=c.get(["intro","intro_background"]),a.item[b].mobile_title_style=c.get(["m_title"]),a.item[b].mobile_paragraph_style=c.get(["m_paragraph"]),a.item[b].mobile_paragraph_bg_style=c.get(["m_paragraph_background"]),a.item[b].mobile_intro_style=c.get(["m_intro"]),a.item[b].mobile_intro_bg_style=c.get(["m_intro_background"]),a.item[b].product.length?a.item[b].hasProducts=!0:a.item[b].hasProducts=!1;for(var d=0;d<a.item[b].product.length;d++){a.item[b].product[d].hasParagraph=!!a.item[b].product[d].title||a.item[b].product[d].price||a.item[b].product[d].button,a.item[b].product[d].index=d,a.item[b].product[d].category=b,a.item[b].product[d]=B(a.item[b].product[d]);var e=new StyleModel(a.item[b].product[d].style_product);a.item[b].product[d].title_style=e.get(["title"]),a.item[b].product[d].price_style=e.get(["price"]),a.item[b].product[d].paragraph_style=e.get(["paragraph"]),a.item[b].product[d].background_style=e.get(["background"]),a.item[b].product[d].mobile_title_style=e.get(["m_title"]),a.item[b].product[d].mobile_price_style=e.get(["m_price"]),a.item[b].product[d].mobile_paragraph_style=e.get(["m_paragraph"]),a.item[b].product[d].mobile_background_style=e.get(["m_background"])}}},this.didDisappear=function(){},this.destroy=function(){o=null}}Loader.loadComplete();