function ScrollblocksController(){function a(){var a=!1;"top"==c.content.nav_type&&(c.content.nav_type="circle",a=!0),f.init(d.container,NavigationButtonType[c.content.nav_type.toUpperCase()]),f.setTop(a)}function b(a){g.each(function(){"undefined"!=typeof $(this)[0].imParallax&&$(this)[0].imParallax.onScroll()});var b=a.scrollTop(),c=Math.max(0,a[0].scrollHeight-Magazine.pages.height),e=100/(c/b);"undefined"!=typeof f&&null!==f&&f.onScroll(b,b+Magazine.pages.height,a[0].scrollHeight),Math.floor(e/25)!=n&&(n=Math.floor(e/25),Magazine.tracker.trackEvent("Scroll",b>m?"Down":"Up",25*n+"%")),d.onScrollHandler(b),m=b}var c,d,e,f,g,h,i,j=this,l=[],m=0,n=0,o=IntroAnimation.contentType,p=IntroAnimation.textType,q=1,r=[];this.init=function(a){d=a},this.initSliders=function(){e=[];for(var a in c.content.rows)if("object"==typeof c.content.rows[a].cover&&null!==c.content.rows[a].cover&&"undefined"!=typeof $(".im-sb-slider",d.container)[e.length]){var b={media:$(".im-sb-slider",d.container)[e.length].imMedia,data:c.content.rows[a].cover};b.media.useCarousel(!0);for(var a in b.data)if("is_slider"!==a){var f=b.data[a],g=new StyleModel(f.style);null!==f.background&&b.media.addImage({src:f.background,title:f.title_1,titleStyle:g.get(["line_1_bg","line_1_font"]),titleStyleMobile:g.get(["line_1_mobile_font"]),subtitle:f.title_2,subtitleStyle:g.get(["line_2_bg","line_2_font"]),subtitleStyleMobile:g.get(["line_2_mobile_font"]),titlePosition:f.position?f.position.split(" "):null})}b.media.render().show(),e.push(b)}},this.initMaps=function(){for(var a in c.content.rows){var b=c.content.rows[a].gmaps;if("object"==typeof b&&null!==b){var e=$($(".im-sb-block-row",d.container)[a]),f=b[0];h=new GoogleMaps,i=$(".im-sb-maps",e),i.append(h.getView()),h.setHeight(f.map_height);var g=GoogleMaps.getMapDataByUrl(f.maps);h.init({coordinates:g,zoom:g.zoom}),h.addMarker({coordinates:g,action:f.action,image:f.image,animation:f.check}),r.push(h)}}},this.willLoad=function(){},this.willLoadView=function(a){},this.didLoad=function(a){c=a},this.didLoadView=function(){g=d.container.scanDirectives(d),null!==c.content.nav_type&&"undefined"!=typeof c.content.nav_type&&(f=new NavigationButtons,a(),f.onUp=function(){j.scrollTo(-Magazine.pages.height,!0),Magazine.tracker.trackEvent("Scroll","Click","Up")},f.onDown=function(){j.scrollTo(Magazine.pages.height,!0),Magazine.tracker.trackEvent("Scroll","Click","Down")}),null!=c.content.background&&d.getBackground().init([c.content.background]),d.hasBackground&&(d.container.prepend(d.getBackground().render()),d.getBackground().show()),!Magazine.device.isIE8&&Magazine.device.size>DeviceSize.MOBILE_LANDSCAPE&&this.handleAnimations(),d.scanDirectives(),this.initSliders(),$(".block-row",d.container).each(function(a){$(this).css("opacity",0)}),$(".block-row-text",d.container).each(function(){$(".paragraph p",this).length>0&&$(this).css("text-align",$($(".paragraph p",this)[0]).css("text-align"))})},this.handleAnimations=function(){$(".im-sb-block-row",d.container).each(function(a){var b=$(this).children().attr("class"),d=300,e=400,f=Magazine.device.getCssProperty("animation-delay"),g={text_img_quote:"block-row-text-image-quote",img_text:"block-row-image-text",text:"block-row-text",video:"block-row-video",img_quote:"block-row-image-quote",slider:"block-row-slider",custom:"block-row-custom",gmaps:"block-row-maps"};if("string"==typeof b)switch(!0){case b.indexOf(g.text_img_quote)!==-1:var h,i;c.content.rows[a]&&void 0!==c.content.rows[a].text_image_quote&&(0==c.content.rows[a].text_image_quote[0].content_position?$(this).children().children().each(function(a){$(this).addClass("parallax-in-1").css(f,(a+q)*d+"ms"),h=q+1,i=q+2}):$($(this).children().children().get().reverse()).each(function(a){$(this).addClass("parallax-in-1").css(f,(a+q)*d+"ms"),h=q+2,i=q+1})),$(this).find(".paragraph").each(function(a){$(this).addClass("parallax-in-2").css(f,(a+h*q)*e+"ms")}),$(this).find(".im-ts-quote").each(function(a){$(this).children().addClass("parallax-in-2").css(f,(a+i*q)*e+"ms")});break;case b.indexOf(g.img_text)!==-1:$(this).children().each(function(a){$(this).addClass("parallax-in-1").css(f,(a+q)*d+"ms")}),$(this).find(".column-padding").each(function(a){$(this).addClass("parallax-in-2").css(f,(a+2)*e+"ms")});break;case b.indexOf(g.text)!==-1:$(this).children().each(function(a){$(this).addClass("parallax-in-1").css(f,(a+q)*d+"ms")}),$(this).children().children().each(function(a){$(this).addClass("parallax-in-2").css(f,(a+2*q)*e+"ms")});break;case b.indexOf(g.video)!==-1:$(this).children().children().each(function(a){$(this).addClass("parallax-in-1").css(f,(a+q)*d+"ms")});break;case b.indexOf(g.img_quote)!==-1:c.content.rows[a]&&void 0!==c.content.rows[a].image_quote&&0==c.content.rows[a].image_quote[0].content_position?$(this).children().children().each(function(a){$(this).addClass("parallax-in-1").css(f,(a+q)*d+"ms")}):$($(this).children().children().get().reverse()).each(function(a){$(this).addClass("parallax-in-1").css(f,(a+q)*d+"ms")}),$(this).find(".im-ts-quote").each(function(a){$(this).children().addClass("parallax-in-2").css(f,(a+2*q)*e+"ms")});break;case b.indexOf(g.slider)!==-1:$(this).children().children().each(function(a){$(this).addClass("parallax-in-1").css(f,(a+q)*d+"ms")});break;case b.indexOf(g.custom)!==-1:$(this).children().children().each(function(a){$(this).addClass("parallax-in-1").css(f,(a+q)*d+"ms")}),$(this).find(".paragraph").each(function(a){$(this).addClass("parallax-in-2").css(f,(a+2*q)*e+"ms")});break;case b.indexOf(g.gmaps)!==-1:$(this).children().each(function(a){$(this).addClass("parallax-in-1").css(f,(a+q)*d+"ms")})}})},this.willAppear=function(a){d.isFirstView()&&($(".block-column-image-text-content",d.container).each(function(){$("h2",this).hasTransparentBackground()&&$("h2",this).css({"padding-top":"0px","padding-bottom":"0px"}),$(".paragraph",this).hasTransparentBackground()&&$(".paragraph",this).css({"padding-top":"0px","padding-bottom":"0px"})}),this.initMaps());for(var b in e)e[b].media.render().show();null!==g&&g.each(function(){"undefined"!=typeof this.imMedia&&this.imMedia.reset()}),"undefined"!=typeof a.item&&$(".im-sb-block-row",d.container).get(a.item)&&this.scrollTo($($(".im-sb-block-row",d.container).get(a.item)),!0)},this.resetVideos=function(){if(l)for(var a=0;a<l.length;a++)l[a].reset()},this.initVideos=function(){$(".im-ts-videocontainer",d.container).each(function(a){var b=new Video($(this));this.video=b,b.setPlaybackQuality("hd720"),l.push(b)})},this.didAppear=function(){for(this.onEndResizeHandler(Magazine.device),d.isFirstView()?($(".block-row",d.container).css("opacity",1),Magazine.device.isIE9?setTimeout(function(){d.controller.initVideos()},800):d.controller.initVideos()):d.controller.resetVideos(),$(".im-sb-wrapper",d.container).on("scroll mousewheel",function(){b($(this))}),b($(".im-sb-wrapper",d.container)),k=0;k<r.length;k++)r[k].triggerResize()},this.willDisappear=function(){if(l.length>0)for(var a in l)l[a].pause();if("object"==typeof e)for(var a in e)e[a].media.pause()},this.didDisappear=function(){},this.render=function(a){for(var b in a.rows){for(var c=["text_image_quote","text_image","videos","image_quote","text","custom_advanced","cover"],d=a.rows[b],e=0;e<c.length;e++)e!=d.row_type&&delete d[c[e]];for(var f in d){if("cover"===f&&null!==d[f])d[f].is_slider=!0;else if("text_image_quote"===f){if(d[f]&&d[f].length)for(var b=0;b<d[f].length;b++)d[f][b]&&""===d[f][b].quote&&(d[f][b].quote=null)}else if("custom_advanced"===f){var g=4;if(null!==d[f]){var h=d[f].length,i=0,j=[];for(var e in d[f])switch(g<=h-e&&(d[f][e].columns=1),1===i?(d[f][e].columns_width="50",e>0&&(d[f][e-1].columns_width="50"),i=0):i=parseInt(d[f][e].columns),2==parseInt(d[f][e].columns)?j.push("l"):j.push("s"),g-=parseInt(d[f][e].columns),d[f][e].block_type){case 2:d[f][e].block_type_video=!0;break;case 1:d[f][e].block_type_image=!0;break;default:case 0:d[f][e].block_type_text=!0}d[f].pattern="pattern-"+j.join("-"),d[f].is_custom_advanced=!0}}for(var k in d[f])for(var l in d[f][k]){var m=d[f][k];"title"===l?"string"==typeof m[l]&&0===m[l].length&&(m[l]=null):"style"===l&&(m[l]=new StyleModel(m[l]),m.style_title=m[l].get(["title","background_title"]),m.m_style_title=m[l].get(["m_title"]),m.style_subtitle=m[l].get("subtitle"),m.m_style_subtitle=m[l].get("m_subtitle"),m.style_paragraph=m[l].get(["paragraph","background_paragraph"]),m.m_style_paragraph=m[l].get("m_paragraph"),m.style_background_quote=m[l].get("background_quote"),m.style_background=m[l].get(["background","block_padding"]),m.style_background_quote||(m.style_background_quote=m[l].get("background")),m.style_quote=m[l].get("quote"),m.style_quote_mobile=m[l].get("quote_mobile"))}}}},this.onOrientationChange=function(){},this.onHashChange=function(a){"undefined"!=typeof a.item&&$(".im-sb-block-row",d.container).get(a.item)&&this.scrollTo($($(".im-sb-block-row",d.container).get(a.item)),!0)},this.onEndResizeHandler=function(a){for(k=0;k<r.length;k++)r[k].onResizeHandler(a);Magazine.device.size>DeviceSize.MOBILE_LANDSCAPE?($(".block-row-text-image-quote",d.container).each(function(){var a=$(".block-column-text",this);a.height()%2===0?($(".block-column-image-quote table",this).height(a.height()+60),a.css("padding-bottom","30px")):($(".block-column-image-quote table",this).height(a.height()+61),a.css("padding-bottom","31px"))}),$(".block-row-video .im-ts-videocontainer",d.container).each(function(){$(this).height(9*$(this).width()/16)}),$(".block-row-image-quote",d.container).each(function(){$(".block-column-image",this).height($(".block-column-quote",this).outerHeight())})):($(".block-column-image-quote table",d.container).css("height",""),$(".block-row-image-quote",d.container).each(function(){$(".block-column-image",this).height($(".block-column-quote",this).outerHeight())})),g.each(function(){void 0!==$(this)[0].imParallax&&$(this)[0].imParallax.onResizeHandler(a)}),Magazine.device.size>DeviceSize.MOBILE&&$(".block-row-custom",d.container).each(function(){var a=$(".block-column-custom-content",this).map(function(){return $(this).outerHeight()}).get();0===a.length&&a.push(230);var b=Math.max.apply(null,a);b=Math.max($(".im-ts-videocontainer.small",this).width()*(9/16),b),$(".block-column-custom",this).height(b),$(".block-custom-image",this).height(b),$(".im-ts-videocontainer.small",this).height(b)}),Magazine.device.size<=DeviceSize.MOBILE_LANDSCAPE&&$(".im-media",d.container).each(function(){$(this).hasClass("cover-image")||(Magazine.device.size!==DeviceSize.MOBILE&&$(this).hasClass("block-custom-image")&&"undefined"!=typeof this.imMedia?this.imMedia.resetSize():"undefined"!=typeof this.imMedia&&this.imMedia.containSize())}),"undefined"!=typeof f&&($(".im-sb-wrapper",d.container)[0].scrollHeight>Magazine.pages.height?f.show():f.hide())},this.rowWillAppear=function(){var a=$(this).index(),b=c.content.rows[a];this.imParallax.isFirstView()&&($(this).find(".parallax-in-1").startAnimation(o).css(Magazine.device.getCssProperty("AnimationDuration"),IntroAnimation.duration),$(this).find(".parallax-in-2").startAnimation(p).css(Magazine.device.getCssProperty("AnimationDuration"),IntroAnimation.duration),$(this).css("opacity",1)),6===b.row_type&&$(this).find(".im-sb-slider",d.container).length>0&&$(this).find(".im-sb-slider",d.container)[0].imMedia.show()},this.rowDidDisappear=function(){var a=$(this).index(),b=c.content.rows[a];if(6===b.row_type&&$(this).find(".im-sb-slider",d.container).length>0)try{$(this).find(".im-sb-slider",d.container)[0].imMedia.pause()}catch(a){}if($(this).find(".im-ts-videocontainer",d.container).length>0)try{$(this).find(".im-ts-videocontainer")[0].video.pause()}catch(a){}},this.onSwitchSize=function(a){if(a.size>DeviceSize.MOBILE_LANDSCAPE&&$(".im-media",d.container).each(function(){"undefined"!=typeof this.imMedia&&this.imMedia.resetSize()}),a.size===DeviceSize.MOBILE&&($(".block-column-custom",d.container).css("height",""),$(".block-custom-image",d.container).css("height","200"),$(".im-ts-videocontainer.small",d.container).css("height","170")),"object"==typeof e)for(var b in e)e[b].media.onSwitchSize(a)},this.destroy=function(){},this.scrollTo=function(a){var c,e=$(".im-sb-wrapper",d.container),f={y:e.scrollTop()};c=isNaN(a)?e.scrollTop()+a.offset().top-Magazine.pages.offset.top:e.scrollTop()+a,c=Math.max(0,Math.min(c,e[0].scrollHeight-e.outerHeight())),TweenLite.to(f,1,{y:c,ease:"easeInOutCubic",onUpdate:function(){e.scrollTop(f.y),b(e)}})}}Loader.loadComplete();